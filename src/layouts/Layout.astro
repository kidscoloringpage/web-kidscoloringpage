---
import { Toaster } from 'sonner';
import '../global.css';
import { Footer } from '../components/Global/Footer';
import Authenticator from '../components/AuthFlow/Authenticator.astro';
import Header from '../components/Global/Header.astro';
import { LoginDialog } from '../components/AuthFlow/LoginDialog';
import { ResetPasswordDialog } from '../components/AuthFlow/ResetPasswordDialog';
import { RegisterDialog } from '../components/AuthFlow/RegisterDialog';
import { RecoverPasswordDialog } from '../components/AuthFlow/RecoverPasswordDialog';
import { PendingVerificationDialog } from '../components/AuthFlow/PendingVerificationDialog';
import { PageProgress } from '../components/Global/PageProgress';
import Analytics from '../components/Analytics/Analytics.astro';
import AdminNavigation from '../components/Admin/AdminNavigation.astro';

export interface Props {
  title?: string;
  description?: string;
  noIndex?: boolean;
  canonicalUrl?: string;
  permalink?: string;
  initialLoadingMessage?: string;
}

const {
  title = 'KidsColoringPage.com',
  canonicalUrl: givenCanonical = '',
  permalink,
  description,
  initialLoadingMessage,
  noIndex = false,
} = Astro.props;

// Remove trailing slashes to consider the page as canonical
const currentPageAbsoluteUrl = `https://www.kidscoloringpage.com${permalink || ''}`;
const canonicalUrl = givenCanonical || currentPageAbsoluteUrl;

const paymentSessionId = Astro.url.searchParams.get('session_id') || '';
---

<!doctype html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta
      name='description'
      content={description ||
        'Generate kids coloring pages in seconds. Unleash your imagination! Turn your ideas into coloring pages for your kids to color. From dragons to fairies and more.'}
    />
    {noIndex && <meta name='robots' content='noindex' />}
    <meta
      name='viewport'
      content='width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=3.0, minimum-scale=1.0'
    />
    <meta name='generator' content={Astro.generator} />

    <meta property='og:image:width' content='1200' />
    <meta property='og:image:height' content='413' />
    <meta
      property='og:title'
      content='Generate Coloring Pages For Kids In Seconds'
    />
    <meta property='og:site_name' content='kidscoloringpage.com' />
    <meta property='og:image:alt' content='kidscoloringpage.com' />
    <meta property='og:url' content={currentPageAbsoluteUrl} />
    <meta
      property='og:description'
      content='Generate kids coloring pages in seconds. Unleash your imagination! Turn your ideas into coloring pages for your kids to color. From dragons to fairies and more.'
    />
    <meta property='og:type' content='website' />
    <meta
      property='og:image'
      content='https://www.kidscoloringpage.com/og.png'
    />

    <link rel='canonical' href={canonicalUrl} />

    <meta name='mobile-web-app-capable' content='yes' />
    <meta name='apple-mobile-web-app-capable' content='yes' />
    <meta
      name='apple-mobile-web-app-status-bar-style'
      content='black-translucent'
    />
    <meta name='apple-mobile-web-app-title' content='kidscoloringpage.com' />
    <meta name='application-name' content='kidscoloringpage.com' />

    <link
      rel='apple-touch-icon'
      sizes='180x180'
      href='/manifest/apple-touch-icon.png'
    />
    <meta name='msapplication-TileColor' content='#DA532C' />
    <meta name='theme-color' content='#FFFFFF' />

    <link rel='manifest' href='/manifest/manifest.json' />
    <link
      rel='icon'
      type='image/png'
      sizes='32x32'
      href='/manifest/icon32.png'
    />
    <link
      rel='icon'
      type='image/png'
      sizes='16x16'
      href='/manifest/icon16.png'
    />
    <link
      rel='shortcut icon'
      href='/manifest/favicon.ico'
      type='image/x-icon'
    />

    <link rel='icon' type='image/svg+xml' href='/manifest/favicon.ico' />
    <link rel='sitemap' href='/sitemap-index.xml' />

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-5H869B8J');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Google font -->
    <link rel='preconnect' href='https://fonts.googleapis.com' />
    <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin />
    <link
      rel='preload'
      href='https://fonts.googleapis.com/css2?family=Sansita:ital,wght@0,400;0,700;0,800;0,900;1,400;1,700;1,800;1,900&display=swap'
      as='style'
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <link
      rel='preload'
      href='https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap'
      as='style'
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href='https://fonts.googleapis.com/css2?family=Sansita:ital,wght@0,400;0,700;0,800;0,900;1,400;1,700;1,800;1,900&display=swap'
        rel='stylesheet'
        type='text/css'
      />
      <link
        href='https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap'
        rel='stylesheet'
        type='text/css'
      />
    </noscript>
    <link rel='sitemap' href='/sitemap-index.xml' />
    <title>{title}</title>
  </head>
  <body class='flex min-h-screen flex-col justify-between bg-white'>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src='https://www.googletagmanager.com/ns.html?id=GTM-5H869B8J'
        height='0'
        width='0'
        style='display:none;visibility:hidden'></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->

    <Header>
      <Fragment slot='after-menu'>
        <slot name='after-menu' />
      </Fragment>
    </Header>

    <Toaster richColors={true} client:load />
    <PageProgress initialMessage={initialLoadingMessage} client:idle />

    <slot />

    <slot name='footer'>
      <Footer paymentSessionId={paymentSessionId} client:only='react' />
    </slot>
    <slot name='after-footer' />

    <AdminNavigation />
    <Authenticator />
    <LoginDialog client:only='react' />
    <RegisterDialog client:only='react' />
    <ResetPasswordDialog client:only='react' />
    <RecoverPasswordDialog client:only='react' />
    <PendingVerificationDialog client:only='react' />

    <Analytics />

    <script type='text/javascript'>
      (function (c, l, a, r, i, t, y) {
        c[a] =
          c[a] ||
          function () {
            (c[a].q = c[a].q || []).push(arguments);
          };
        t = l.createElement(r);
        t.async = 1;
        t.src = 'https://www.clarity.ms/tag/' + i;
        y = l.getElementsByTagName(r)[0];
        y.parentNode.insertBefore(t, y);
      })(window, document, 'clarity', 'script', 'l814cfb381');
    </script>
  </body>
</html>
