---
import AuthLayout from "../layouts/AuthLayout.astro";
import Pricing from "../components/Pricing.astro";
import WallOfLove from "../components/WallOfLove.astro";
import HowItWorks from "../components/Dashboard/HowItWorks.astro";
import FreeColoringPages from "../components/Dashboard/FreeColoringPages.astro";
import {MyColoringPages} from "../components/Dashboard/MyColoringPages";
import {GenerateColoringPage} from "../components/Dashboard/GenerateColoringPage";
import {colorSheetApi} from "../api/color-sheet";
import {Faqs} from "../components/Faqs";

const {currentUser} = Astro.locals;
if (!currentUser) {
    return Astro.redirect('/');
}

const { response: {count: totalSheets} } = await colorSheetApi(Astro).count();
---

<AuthLayout>
    <GenerateColoringPage totalCredits={currentUser?.subscription?.trialRequests} usedCredits={totalSheets} client:load />
    { !totalSheets &&
        <Fragment>
            <HowItWorks />
            <FreeColoringPages />
            <WallOfLove />
            <Pricing />
        </Fragment>
    }
    { totalSheets &&
            <Fragment>
                <MyColoringPages client:load />
                <Pricing />
                <WallOfLove />
                <Faqs client:load />
            </Fragment>
    }
</AuthLayout>